<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Risultati Torneo</title>
    <link rel="stylesheet" th:href="@{/generale.css}">
</head>
<body>

<header>
    <div class="header-content">
        <img src="/images/logo_homepage_negativo-trasparente.png" alt="Logo" class="header-logo-small">
        <div class="header-text">
            <h1 id="header-nome-torneo">Premiazione Torneo</h1>
        </div>
    </div>
</header>

<nav>
    <a th:href="@{/homepage}">Home</a>
    <a th:href="@{/contatti}">Chi siamo</a>
    <a th:href="@{/loginadmin}">Area Admin</a>
</nav>

<div class="container">

    <!-- PODIO -->
    <section class="podio epico">

        <div class="podio-step secondo anim-enter">
            <img id="logo-secondo">
            <h3 id="nome-secondo"></h3>
            <span class="medaglia">ü•à</span>
            <div class="gradino"></div>
        </div>

        <div class="podio-step primo anim-enter vincitore">
            <div class="logo-wrapper">
                <img id="logo-primo">
                <span class="trofeo">üèÜ</span>
            </div>
            <h3 id="nome-primo"></h3>
            <span class="medaglia">ü•á</span>
            <div class="gradino"></div>
        </div>


        <div class="podio-step terzo anim-enter">
            <img id="logo-terzo">
            <h3 id="nome-terzo"></h3>
            <span class="medaglia">ü•â</span>
            <div class="gradino"></div>
        </div>

        <div class="podio-step quarto anim-enter fuori-podio">
            <img id="logo-quarto">
            <h3 id="nome-quarto"></h3>
            <span class="medaglia-4">4</span>
            <div class="gradino"></div>
        </div>

    </section>

    <!-- CORIANDOLI -->
    <div id="confetti"></div>


    <section class="mini-tabellone">
        <h3 class="mini-title">Percorso del Torneo</h3>

        <div class="bracket">
            <div class="match semi semi1">
                <span class="match-label">SEMIFINALE 1</span>
                <div class="team">
                    <div class="team-info">
                        <img id="logo-sf1-a" src="" alt="">
                        <span id="gol-sf1-a" class="main-score"></span>
                    </div>
                    <span id="gol-sf1-a-rig" class="penalty-score"></span>
                </div>
                <div class="team">
                    <div class="team-info">
                        <img id="logo-sf1-b" src="" alt="">
                        <span id="gol-sf1-b" class="main-score"></span>
                    </div>
                    <span id="gol-sf1-b-rig" class="penalty-score"></span>
                </div>
            </div>

            <div class="match semi semi2">
                <span class="match-label">SEMIFINALE 2</span>
                <div class="team">
                    <div class="team-info">
                        <img id="logo-sf2-a" src="" alt="">
                        <span id="gol-sf2-a" class="main-score"></span>
                    </div>
                    <span id="gol-sf2-a-rig" class="penalty-score"></span>
                </div>
                <div class="team">
                    <div class="team-info">
                        <img id="logo-sf2-b" src="" alt="">
                        <span id="gol-sf2-b" class="main-score"></span>
                    </div>
                    <span id="gol-sf2-b-rig" class="penalty-score"></span>
                </div>
            </div>

            <div class="match finale">
                <span class="match-label">FINALISSIMA</span>
                <div class="team">
                    <div class="team-info">
                        <img id="logo-fin-a" src="" alt="">
                        <span id="gol-fin-a" class="main-score"></span>
                    </div>
                    <span id="gol-fin-a-rig" class="penalty-score"></span>
                </div>
                <div class="team">
                    <div class="team-info">
                        <img id="logo-fin-b" src="" alt="">
                        <span id="gol-fin-b" class="main-score"></span>
                    </div>
                    <span id="gol-fin-b-rig" class="penalty-score"></span>
                </div>
            </div>

            <div class="match finalina">
                <span class="match-label">FINALE 3¬∞-4¬∞ POSTO</span>
                <div class="team">
                    <div class="team-info">
                        <img id="logo-finl-a" src="" alt="">
                        <span id="gol-finl-a" class="main-score"></span>
                    </div>
                    <span id="gol-finl-a-rig" class="penalty-score"></span>
                </div>
                <div class="team">
                    <div class="team-info">
                        <img id="logo-finl-b" src="" alt="">
                        <span id="gol-finl-b" class="main-score"></span>
                    </div>
                    <span id="gol-finl-b-rig" class="penalty-score"></span>
                </div>
            </div>
        </div>
    </section>


    <div class="button-row">
        <button th:attr="onclick=|window.location.href='/stats/tornei'|">Statistiche Torneo</button>
        <button th:attr="onclick=|window.location.href='/tabellone'|">Nuovo Torneo</button>
        <button th:attr="onclick=|window.location.href='/homepage'|">Home Page</button>
    </div>

</div>


<footer>
    <p>&copy; 2024 Sprint Football Simulation - Generation Sport</p>
</footer>

<script>
    document.addEventListener("DOMContentLoaded", () => {

        // Nome torneo
        const nomeTorneo =
            sessionStorage.getItem("nomeTorneoAttuale") || "Torneo";

        document.getElementById("header-nome-torneo").innerText =
            "Premiazione " + nomeTorneo;

        // Dati torneo
        const data = JSON.parse(sessionStorage.getItem("risultatoTorneo"));
        if (!data) {
            window.location.href = "/homepage";
            return;
        }

        // ü•á PRIMO POSTO
        document.getElementById("nome-primo").innerText = data.primo.nome;
        document.getElementById("logo-primo").src = data.primo.logo;

        // ü•à SECONDO POSTO
        document.getElementById("nome-secondo").innerText = data.secondo.nome;
        document.getElementById("logo-secondo").src = data.secondo.logo;

        // ü•â TERZO POSTO
        document.getElementById("nome-terzo").innerText = data.terzo.nome;
        document.getElementById("logo-terzo").src = data.terzo.logo;

        // QUARTO POSTO
        document.getElementById("nome-quarto").innerText = data.quarto.nome;
        document.getElementById("logo-quarto").src = data.quarto.logo;
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const confetti = document.getElementById("confetti");

        for (let i = 0; i < 120; i++) {
            const c = document.createElement("div");
            c.style.position = "absolute";
            c.style.left = Math.random() * 100 + "vw";
            c.style.top = "-20px";
            c.style.width = "10px";
            c.style.height = "10px";
            c.style.background = ["gold", "white", "red"][Math.floor(Math.random()*3)];
            c.style.animation = `fall ${3 + Math.random()*3}s linear infinite`;
            c.style.opacity = Math.random();
            confetti.appendChild(c);
        }
    });
</script>

<style>
    @keyframes fall {
        to {
            transform: translateY(110vh) rotate(720deg);
        }
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", () => {

        const stato = JSON.parse(sessionStorage.getItem("statoTorneo"));
        if (!stato || !stato.risultati) return;

        function render(match, la, ga, lb, gb) {
            if (!match) return;

            // LOGHI
            document.getElementById(la).src = match.home.logo;
            document.getElementById(lb).src = match.away.logo;

            // GOL TEMPI REGOLAMENTARI
            document.getElementById(ga).innerText = match.home.gol;
            document.getElementById(gb).innerText = match.away.gol;

            // RIGORI (se presenti)
            const rigA = document.getElementById(ga + "-rig");
            const rigB = document.getElementById(gb + "-rig");

            if (match.rigori) {
                rigA.innerText = "(" + match.rigori.home + ")";
                rigB.innerText = "(" + match.rigori.away + ")";
            } else {
                rigA.innerText = "";
                rigB.innerText = "";
            }
        }

        const r = stato.risultati;

        render(r.semi1, "logo-sf1-a", "gol-sf1-a", "logo-sf1-b", "gol-sf1-b");
        render(r.semi2, "logo-sf2-a", "gol-sf2-a", "logo-sf2-b", "gol-sf2-b");
        render(r.finalissima, "logo-fin-a", "gol-fin-a", "logo-fin-b", "gol-fin-b");
        render(r.finale34, "logo-finl-a", "gol-finl-a", "logo-finl-b", "gol-finl-b");

        function highlightWinner(match, matchSelector) {
            if (!match) return;

            const teams = document.querySelectorAll(matchSelector + " .team");
            if (teams.length !== 2) return;

            let winnerIndex = null;

            // vince nei tempi
            if (match.home.gol > match.away.gol) winnerIndex = 0;
            else if (match.home.gol < match.away.gol) winnerIndex = 1;

            // vince ai rigori
            if (winnerIndex === null && match.rigori) {
                if (match.rigori.home > match.rigori.away) winnerIndex = 0;
                else winnerIndex = 1;
            }

            if (winnerIndex !== null) {
                teams[winnerIndex].classList.add("winner");
            }
        }

        // semifinali ‚Üí chi va in finale
        highlightWinner(r.semi1, ".semi1");
        highlightWinner(r.semi2, ".semi2");

        // finale ‚Üí vincitore torneo
        highlightWinner(r.finalissima, ".finale");

        // finalina ‚Üí vincitore 3¬∞ posto
        highlightWinner(r.finale34, ".finalina");

    });
</script>

</body>
</html>